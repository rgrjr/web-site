<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html> <head>
<title>ICanCAD def-name and library internals</title>
</head>

<body bgcolor=white>
<h2>ICanCAD <tt>def-name</tt> and library internals</h2>

<p><a href="/"><tt>Home</tt></a> : <a href="index.html">ICanCAD</a> :
Internals : Libraries
<hr>

<p>Libraries name a group of related defs.  Each (fully merged) def name
includes a library name as well as a design name and view; these
correspond to the directory, file name, and file type (or extension)
concepts used to name files in many file systems, and in fact there is a
direct mapping when the file system is used to save the def to disk.
Like directories, libraries have hierarchical names.

<h3>Table of Contents</h3>

<!-- hhmtoc start -->
<ol>
  <li> ICanCAD <tt>def-name</tt> and library internals
       <ol>
	 <li> Table of Contents
	 <li> <a href="#reasons">Rationale</a>
	 <li> <a href="#syntax">Def name syntax</a>
	 <li> <a href="#translation"><tt>def-name</tt> translation</a>
	 <li> <a href="#lib-objects">Library objects</a>
       </ol>
</ol>
<!-- hhmtoc end -->

<a name = reasons>
<h3>Rationale</h3>

<dl>

       <p>
  <dt> <b>Why not just use file names to name defs?</b>
  <dd> At any given site, the risk of having simple names such as
       "inv.schematic" collide is usually pretty high, so it is much
       better to use some kind of compound name, such as directories
       provide.  File names that use absolute directories are therefore
       more expressive, and unambiguous, but they are not very portable,
       e.g. between design centers and their clients, or between
       publishers of cell libraries and designers at other sites who
       wish to use those libraries.  Relative pathnames (with or without
       any directory components) are more portable, but only within the
       same operating system family, and they are ambiguous, since some
       additional knowledge is needed to find the actual file.  Hence, a
       library name that behaves like an absolute file name but can be
       mapped into an arbitrary directory provides the best of both
       worlds.

       <p>
  <dt> <b>How about relative names with a search list?</b>
  <dd> That strikes us as a step in the wrong direction.  Such names
       aren't well-defined without knowing the search list.  And it is
       easy to create two independent designs that cannot be loaded
       simultaneously because of name conflicts.  It may then be
       necessary to change the search path frequently during the course
       of a working day, which opens up the possibility of breaking a
       design by forgetting to reset the search path.  You may wind up
       fabricating something you've never simulated!  Using absolute
       names eliminates all such confusion.

       <p>
  <dt> <b>So, why the funky colons and semicolons?</b>
  <dd> Common Lisp (and other Lisp dialects before it) have the concept
       of a <a href="glossary.html#logical-pathname"> "logical pathname"
       (LPN)</a> as an OS-independent way of naming files.  ICanCAD def
       names are conceptually based on logical pathnames, and follow the
       Common Lisp logical pathname syntax.  [Right now, it actually
       diverges from CL syntax.  -- rgr, 11-Mar-01.]

       <p>
  <dt> <b>Then why not use logical pathnames directly?</b>
  <dd> This is actually a good idea.  Not only do I happen to think that
       CL syntax is better than the legacy def name syntax, using LPNs
       directly would also allow more intuitive naming of defs.  In
       particular, ICanCAD could name defs based on the files in which
       they get saved, as all other applications do.  Users would still
       have to deal with logical names, in order to preserve design
       portability, but only when they wanted to add a use.

       <p>In other words, since we can't completely hide either the
       portable logical names or the actual physical names from the
       user, we are better off embracing this "dual naming" requirement
       explicitly.  (Though there will probably always be a
       <tt>def-name</tt> object used internally to mask the differences
       between the two.)
</dl>

<a name = syntax>
<h3>Def name syntax</h3>

A fully-specified def name looks like the following:

<blockquote>
<i>topname</i> : <i>subname<sub>1</sub></i> : <i>subname<sub>2</sub></i>
; <i>name</i> . <i>view</i>
</blockquote>

<ol>
  <li> The <i>topname</i> and at least one <i>subname<sub>i</sub></i>
       must be specified, separated by colons and terminated by a
       semicolon.  [Historically, this was a Janus requirement, because
       of the way Janus def names were defined; it may no longer be
       necessary.  -- rgr, 11-Mar-01.]
  <li> The <i>topname</i>, <i>subname<sub>i</sub></i>, <i>name</i>, and
       <i>view</i> tokens are all identifiers, and must consist only of
       alphanumerics plus the "-" character.
  <li> Wildcards may be specified for the "name" fields with "*", but
       such def names may not be used to name actual defs.  The view may
       be "*", or a name that does not contain a "*".
  <li> The first character of a name or view token may be a digit, but
       not a "-" (to avoid Unix complications).
  <li> Spaces between a name and an adjacent delimiter (":", ";", or
       ".") are ignored.  Spaces between two adjacent names are replaced
       by a single "-", so that the two names are considered a single
       token.
  <li> For backward compatibility, an optional version may be suffixed,
       but ICanCAD will signal an error if that version isn't ".newest".
</ol>

<p>[show syntax used for parsing.  -- rgr, 11-Mar-01.]

<p>[should enumerate view names -- both presently defined, and reserved
for future extension.  -- rgr, 11-Mar-01.]

<a name = translation>
<h3>Mapping def names to local file names</h3>

Def names are translated to host-dependent pathnames (file names) by way
of the "ICANCAD-DESIGNS" <a
href="glossary.html#logical-pathname">logical pathname</a> host.  For
example, the host-dependent pathname for the
<tt>"foo:bar;quux.schematic"</tt> def comes from translating the
<tt>"ICANCAD-DESIGNS:FOO;BAR;QUUX.SCHEMATIC"</tt> logical pathname.  (Note how
the colons and semicolons are not used in quite the same way in ANSI
logical pathnames as in def names.  More historical baggage.)

<p>The <tt>"ICANCAD-DESIGNS"</tt> logical pathname translations are set
up in a semi-implementation-dependent way.  One portable way of doing so
is to put a form similar to the following in an <a
href="general.html#startup">init file</a>:
<blockquote>
<pre>
(setf (logical-pathname-translations "ICANCAD-DESIGNS")
      '(("alfred;**;*.*" "/home/alfred/icancad/**/*.*")
	("bertha;**;*.*" "/home/bertha/projects/designs/**/*.*")
	("bigco;**;*.*" "/usr/local/bigco/projects/**/*.*")
	("*;**;*.*" "/home/*/icancad/**/*.*")))
</pre>
</blockquote>
Each line after the first includes a <i>rule</i> that is specified by a
list of two items: a string naming a wildcarded logical pathname, and a
string naming the wildcarded physical pathname to which files matching
the logical name should be mapped.  Note that the logical directory
component names all have a semicolon (<tt>";"</tt>) immediately after
them.  Two adjacent asterisks (e.g. <tt>"**"</tt>) can only appear as a
directory component name, and indicate that zero or more directories
("wild inferiors") may appear in that place.  Elsewhere, an asterisk
(<tt>"*"</tt>) has the usual "match zero or more characters" meaning; in
this example, they are used to map the file name and type without
change, which is customary.

<p>For the directories, the wild components (<tt>"*"</tt> and
<tt>"**"</tt>) must correspond; occurrences of <tt>"**"</tt> and names
with one or more <tt>"*"</tt> in them must appear in the same order and
with the same number and type of <tt>"*"</tt>'s in both logical and
physical directories.  As shown in the example, interspersed nonwild
names need not correspond.

<p>When translating a given logical pathname, the system goes down the
list and uses the first rule that matches in order to produce the
physical pathname.  Consequently, the rules must be ordered from most
specific to most general, to avoid conflicts.

<p>Getting back to the example, the def name
<tt>"foo:bar;quux.schematic"</tt> def would be mapped to the
<tt>"ICANCAD-DESIGNS:FOO;BAR;QUUX.SCHEMATIC"</tt> logical pathname,
which in turn would be translated by the last rule to the
<tt>"/home/foo/icancad/bar/quux.schematic"</tt> physical pathname.

<p>[using a single logical host, e.g. "ICANCAD-DESIGNS", has the
disadvantage that translations are defined globally, which makes it
harder for users to tweak their own.  -- rgr, 11-Mar-01.]

<a name = lib-objects>
<h3>Library objects</h3>

At this point in its evolution, we see no need for explicit library
objects, since the contents of the library are completely specified by
the state of the filesystem directory to which it maps.  If that ever
changes, the library object will be stored in a file with the literal
name <tt>"icancad.library"</tt> in the library's directory.

<p>[On the other hand, it would be nice to be able to set policy for the
defs of a given library, such as whether or not certain
Cadence-incompatible features should be disabled.  Such policy switches
would be best kept in a library object, which would live in a library
file on disk.  The presence of a library file could then be used to
check whether a given directory was actually an ICanCAD library or not.
Rel-Janus used alists of (def-name . value), or equivalent, for defining
these sorts of per-library options, which was really ugly.  -- rgr,
11-Apr-01.]

<p>[In the future, it may be possible to save defs into a relational
database, at which time a library class will be added to support loading
from and storing into relational tables.  At this point, the notion of
"library's directory" will become ill-defined, and we'll have to think
of something better.  -- rgr, 11-Mar-01.]

<p>[NB: Relational libraries might make it possible to support versions
in a meaningful way.  That would mean we could provide a command that
would ask ICanCAD to show the version of a def that was in effect on a
given date in the past.  -- rgr, 11-Mar-01.]

<p>
<hr>
<address><a href="mailto:rogers@rgrjr.dyndns.org">Bob Rogers
	<tt>&lt;rogers@rgrjr.dyndns.org&gt;</tt></a></address>
<!-- hhmts start -->
Last modified: Thu Feb 21 22:30:15 EST 2002
<!-- hhmts end -->
</body> </html>
