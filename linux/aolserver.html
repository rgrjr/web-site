<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
<head>
<title>Bob Rogers: Local "howto" information:  AOLserver</title>
<link href="../site.css" title="Default" rel="stylesheet" type="text/css">
</head>

<body>
<h3>AOLserver</h3>

<i>[NB:  This page is out of date; I am no longer using AOLserver.  When
the main server failed in June 2004, I had to switch to a new server in
a hurry, which had <a href="http://www.apache.org/">Apache</a>
preinstalled.  When things calmed down, I decided I was too lazy to
switch back.  -- rgr, 18-Dec-04.]</i>

<p><a href="/"><tt>Home</tt></a> : <a href="index.html">Linux
resources</a> : <a href="howto.html">"Howto"</a> : AOLserver
<hr>

<p>Why run AOLserver?  It's fast, reliable, and exploits are rare
(unlike some other servers we could mention).

<p>I am currently running AOLserver 3.4 (as of 7-Sep-01).  Note that
version 3.2 and prior are subject to a denial-of-service attack (see
mail from Nate Haggard <tt>&lt;nate <i>at</i>
securitylogics.com&gt;</tt> to <tt>&lt;bugtraq <i>at</i>
securityfocus.com&gt;</tt> re "AOLserver 3.0 vulnerability" on 22 Aug
2001 at 16:51:45 -0600 [should get the ref from <a
href="http://www.securityfocus.com/">
<tt>http://www.securityfocus.com/</tt></a>]).

<p><tt>nsd</tt> daemon startup is done by the
<tt>/etc/init.d/nsd</tt> script; the command it uses is is
<pre>
	nsd -t /usr/local/aolserver/config.tcl -u nsadmin -g web
</pre>
(where the binary is in <tt>/usr/local/aolserver/bin/</tt> on
<tt>$PATH</tt>).  This must be done as root, so that the daemon can bind
to port 80.  Add -f to run in "test mode" in foreground, but first be
sure to do <tt>"/etc/init.d/nsd&nbsp;stop"</tt> to make the daemon
go away.  You can add -k to kill and restart, or -K to kill and leave
dead (still needs <tt>config.tcl</tt> and <tt>-u/-g</tt> args), but this
is better done via the init script.

<p>The configuration file for this server,
<tt>/usr/local/aolserver/config.tcl</tt>, does
<tt>'set&nbsp;servername&nbsp;"rgrjr"'</tt>, which (I think) is how it
knows that the pages are kept in the
<tt>/usr/local/aolserver/servers/rgrjr/pages/</tt> directory.

<a name="aol-no-dns">
<h4>AOLserver without DNS</h4>

Note that if <tt>nsd</tt> is started when DNS service is not available,
such as when the external cable modem is unconnected, the
<tt>nssock.so</tt> module will fail to load, which is fatal.
<tt>nsd</tt> will exit immediately, but if it was started via
<tt>/etc/inittab</tt>, the <tt>init</tt> process will notice and try to
start it up again, putting about 10Mbytes of startup garbage in
<tt>/usr/local/aolserver/log/server.log</tt> per day.  There may be a
config file workaround, but in any case, it is cleaner to use a SysV
startup script.  [I could fix it to omit startup when we can figure out
that the external network is not usable.  -- rgr, 7-Sep-01.  But that's
not really necessary; it fails once, but that doesn't hurt anything.  --
rgr, 15-Dec-02.]

<a name="aol-access">
<h4>The AOLserver <tt>access.log</tt></h4>

<p>To get a summary of the hits recorded in the access log, try
<pre>
	page-hits.pl -nolocal /usr/local/aolserver/servers/rgrjr/modules/nslog/access.log
</pre>

<p>I [used to] rotate the logs manually every month by the following
method:
<ol>
  <li> Comment out the <tt>/etc/inittab</tt> entry.
  <li> <tt>"telinit&nbsp;q"</tt>
  <li> In the <tt>/usr/local/aolserver/log/</tt> directory, rename
       <tt>server.log</tt> to (e.g.)
       <tt>server.200008.log</tt>.
  <li> In <tt>/usr/local/aolserver/servers/rgrjr/modules/nslog</tt>, rename
       <tt>access.log</tt> to <tt>access.200008.log</tt> (or whatever).
  <li> Revert to the old <tt>/etc/inittab</tt> version.
  <li> <tt>"telinit&nbsp;q"</tt>
  <li> Do <tt>chmod 640</tt> for both <tt>access.log</tt> and
       <tt>server.log</tt>, since they are otherwise world-readable.
       [Probably should report this as a bug.  -- rgr, 3-Dec-00.]
</ol>

<p>[much later . . . ]

<p>Oops, I'm an idiot.  It's much easier to tell the server to rotate
the logs by sending it a <tt>SIGHUP</tt>, assuming you have
<tt>"ns_param rollonsignal true"</tt> in the "nslog" section of the
<tt>/usr/local/aolserver/config.tcl</tt> file.

<p>I currently roll the AOLserver log on the first day of every month
via a <tt>crontab</tt> entry:
<blockquote>
<pre>
# rotate the AOLserver logs monthly, at midnight on the 1st.  -- rgr, 3-Feb-01.
0 0 1 * *	kill -HUP `cat /usr/local/aolserver/log/nspid.rgrjr`
</pre>
</blockquote>
This will probably generate some kind of error if the server is not
running, in which case <tt>cron</tt> will send me email.  That is a good
thing, as I'll have to roll the log manually in that case.

<a name="aol-links">
<h4>AOLserver links</h4>

<ul>
  <li> <a href="http://aolserver.com/">About AOLserver</a>
  <li> <a href="http://sourceforge.net/projects/aolserver/">
       Sourceforge.net: Project Info - AOLserver</a>
  <li> <a href="http://aolserver.com/docs/">AOLserver documentation</a>
       (terse, at best).  See especially the <a
       href="http://aolserver.com/docs/admin/"> AOLserver Administration
       Guides</a> pages.
</ul>

<p>
<hr>
<address><a href="/bob/contact.html">Bob Rogers
	<tt>&lt;rogers@rgrjr.dyndns.org&gt;</tt></a></address>
$Id$
</body>
</html>
