<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
<head>
<title>Bob Rogers: Local "howto" information</title>
<link href="../site.css" title="Default" rel="stylesheet" type="text/css">
</head>

<body>
<h1>Local "howto" information</h1>

<p>[still in the process of updating this.  -- rgr, 19-Dec-04.]

<p><a href="/"><tt>Home</tt></a> : <a href="index.html">Linux
resources</a> : "Howto"
<hr>

<p>This page contains "howto" information for random bits of hardware
and software.  Some of it is general, but some is very specific to my
configuration, so it may break for yours; use caution when trying any of
this stuff.

<h2>Table of contents</h2>

Related pages:
<ul>
  <li> <a href="ntp.html">Automatic clock setting from an NTP time server</a>
  <li> <a href="qmail.html">The <tt>qmail</tt> mail transport agent</a>
  <li> <a href="squid.html">Squid</a>
  <li> <a href="cd-burning.html">Burning CD-R disks</a>
       <ol>
	 <li> <a href="cd-burning.html#options">Selected
	      <tt>mkisofs</tt> and <tt>cdrecord</tt> options</a>
	 <li> <a href="cd-burning.html#howto">CD-R how-to</a>
       </ol>
  <li> <a href="aolserver.html">AOLserver</a>
       <ol>
	 <li> <a href="aolserver.html#aol-no-dns">AOLserver without DNS</a>
	 <li> <a href="aolserver.html#aol-access">The AOLserver
	      <tt>access.log</tt></a>
	 <li> <a href="aolserver.html#aol-links">AOLserver links</a>
       </ol>
  <li> <a href="nis.html">Network Information Service (NIS)</a>
</ul>
These used to be subsections of this page.

<p>Contents of this page:
<!-- hhmtoc start -->
<ol>
  <li> Local "howto" information
       <ol>
	 <li> Table of contents
	      <ol>
		<li> <a href="#glossary">Terminology</a>
	      </ol>
	 <li> <a href="#network">Networking</a>
	      <ol>
		<li> <a href="#ether">Ethernet</a>
		<li> <a href="#net-gen">General IP networking</a>
		<li> <a href="#boot-recovery">If the network doesn't come up after booting</a>
		<li> <a href="#perl-dns">DNS tricks using <tt>perl</tt></a>
	      </ol>
	 <li> <a href="#servers">Servers</a>
	      <ol>
		<li> <a href="#logs">Server logs</a>
		<li> <a href="#ezmlm">The <tt>ezmlm</tt> mailing list manager</a>
		<li> <a href="#netatalk">netatalk</a>
		<li> <a href="#samba">Samba</a>
	      </ol>
	 <li> <a href="#linux">Linux guts</a>
	      <ol>
		<li> <a href="#kernel">Kernel</a>
		<li> <a href="#mem">Memory management</a>
		<li> <a href="#rpm"><tt>rpm</tt> and <tt>rpmfind</tt></a>
		<li> <a href="#xfree86">XFree86</a>
	      </ol>
	 <li> <a href="#hardware">Hardware</a>
	      <ol>
		<li> <a href="#zip">Zip drive</a>
		<li> <a href="#floppy">Floppy disk</a>
	      </ol>
	 <li> <a href="#apps">Applications</a>
	      <ol>
		<li> <a href="#lisps">Alternative lisps</a>
	      </ol>
       </ol>
</ol>
<!-- hhmtoc end -->

<a name=glossary>
<h3>Terminology</h3>

In what follows, I've tried to use the following words consistently:
<ul class="facts">
  <li> <b>Hard drive</b> means just that, though I have a tendency to
       say "disk" instead.  Back when I was introduced to magnetic
       storage, floppies were quite new, so "disk" without qualification
       always meant a rigid disk.  (Probably one with removable media;
       you don't see those anymore, because they can't be made very
       dense.)
  <li> <b>Disk</b> therefore means <a href="#floppy">floppy disk</a> or
       <a href="#zip">zip disk</a>.
  <li> <b>CD</b> covers the fourth kind of disk, though I will sometimes
       use "CD-R disk" when trying to be more specific.
</ul>

<p>
<hr>
<p>
<a name = network>
<h2>Networking</h2>

See also the <a href="security/ssh.html"><b><tt>ssh</tt>: secure
shell</b></a> and <a href="security/firewall.html"><b><tt>ipchains</tt>
firewall script</b></a> pages.

<a name = ether>
<h3>Ethernet</h3>

See my <a href="ether.html">Ethernet Cheat Sheet</a> for Ethernet
pinouts and wire color code conventions.  (This is on a page of its own
for easy printing.)

<p>See also <tt>/usr/doc/HOWTO/Ethernet-HOWTO</tt>, <a
href="http://www.NetworkUptime.com/faqs/ethernet/">
<tt>comp.dcom.lans.ethernet_FAQ</tt></a> and <a
href="http://www.scyld.com/network/eepro100.html">
<tt>http://www.scyld.com/network/eepro100.html</tt></a>.  The
<tt>/sbin/mii-diag</tt> and <tt>/sbin/eepro-diag</tt> commands
(downloaded from the latter) report on detailed Ethernet NIC status.

<a name = net-gen>
<h3>General IP networking</h3>

<ul>
  <li> The <a href="file:/etc/services"> <tt>/etc/services</tt></a> file
       has the port/protocol to service name mapping.
  <li> "netstat -t" reports on open TCP connections.
  <li> Use <tt>"cat /proc/net/dev"</tt> to get a tabular version of
       <tt>ifconfig</tt> output.
  <li> At boot time, the <tt>/etc/init.d/paranoid</tt> script is started
       from <tt>/etc/init.d/boot.local</tt>, then
       <tt>/etc/init.d/network</tt> does the boot-time
       <tt>/sbin/ifup</tt> calls, and finally
       <tt>/etc/init.d/firewall</tt> is called (both of the latter using
       proper SysV style from <tt>/etc/init.d/rc[2345].d/</tt> links).
       See also the <a href="security/firewall.html">
       <b><tt>ipchains</tt> firewall script</b></a> page.
</ul>

<a name="boot-recovery">
<h3>If the network doesn't come up after booting</h3>

Sometimes the external network configuration fails when booting,
possibly due to slow DHCP server response.  When that happens, there is
no connectivity to the outside world, and a number of bad consequences
follow:
<ol>
  <li> The host IP address is unknown, so the firewall script can't
       configure itself.
  <li> DNS name resolution is unavailable, which makes <a
       href="aolserver.html">AOLserver</a> and <a
       href="squid.html">Squid</a> fail.
  <li> Because the world is unreachable (not to mention DNS), <a
       href="ntp.html"><tt>ntpd</tt></a> can't so much as ask anyone for
       the time of day.
</ol>

So to fix all of this, the following things must be done, in this order:

<ol>
  <li> <b>Bring up the interface.</b>  Do this via
       <pre>
       # ifup eth0
       </pre>
       as <tt>root</tt>, of course.  This may take a while, and it may
       fail again, especially if a power outage just ended and the DHCP
       server is swamped with requests (and may still be booting up
       itself).  Do <tt>"ifconfig eth0"</tt> to verify that
       <tt>eth0</tt> really has an IP address.

       <p>
  <li> <b>Bring up the firewall.</b>  You will want to do this before
       starting other services.
       <pre>
       # /etc/init.d/firewall
       </pre>

       <p>
  <li> <b>Start the time daemon manually.</b>
       <pre>
       # /etc/init.d/xntpd restart
       </pre>
       The system clock will get reset almost immediately, which may
       make the screen go blank, if it moves further ahead than your
       screen saver delay interval (mine is 10 minutes).

       <p>
  <li> <b>Start the remaining services manually.</b>
       <pre>
       # /etc/init.d/squid start
       # /etc/init.d/apache2 start
       </pre>
</ol>

<a name=perl-dns>
<h3>DNS tricks using <tt>perl</tt></h3>

<p>Reverse DNS in <tt>perl</tt>:
<pre>
    rgr&gt; perl -e 'use Socket; $iaddr = inet_aton("128.197.54.20"); print join(" ", gethostbyaddr($iaddr, AF_INET)), "\n";'
    DARWIN.BU.EDU  2 4 \200&Aring;6^T
    rgr&gt; 
</pre>

Reverse DNS from a shell (using perl to trim just the host name out of
the nslookup output):
<pre>
    % nslookup -q=PTR 19.200.128.24.in-addr.arpa | perl -ne 'print "$1\n" if /in-addr.arpa\s+name = (.*)$/;'
    h0050da615e79.ne.mediaone.net
    % 
</pre>

<p>
<hr>
<p>
<a name=servers>
<h2>Servers</h2>

See also:
<ul>
  <li> <a href="ntp.html">Automatic clock setting from an NTP time server</a>
  <li> <a href="qmail.html">The <tt>qmail</tt> mail transport agent</a>
  <li> <a href="squid.html">Squid</a>
  <li> <a href="aolserver.html">AOLserver</a>
  <li> <a href="nis.html">Network Information Service (NIS)</a>
</ul>

<a name = logs>
<h3>Server logs</h3>

<p>The various servers I run keep their log files in the following
places:
<blockquote>
<table>
  <tr> <th>What</th> <th>Where</th> </tr>
  <tr>
    <td> <a href="nis.html">NIS</a></td>
    <td> Uses syslog (<tt>/var/log/messages</tt>).</td>
  </tr>
  <tr>
    <td> <a href="qmail.html"><tt>qmail</tt></a></td>
    <td> Uses syslog (<tt>/var/log/mail</tt>, and <tt>/var/log/messages</tt>
	 to a lesser extent), at least when configured without <a
	 href="http://cr.yp.to/daemontools/multilog.html">
	 <tt>multilog</tt></a>.
    </td>
  </tr>
  <tr>
    <td> <a href="#ezmlm"><tt>ezmlm</tt></a></td>
    <td> Each mailing list gets its own log, in the <tt>Log</tt> file
	 immediately under the list directory.  Only such things as
	 subscribe/unsubscribe events are logged.
  </tr>
  <tr>
    <td> <a href="#netatalk">netatalk</a></td>
    <td> Uses syslog (<tt>/var/log/messages</tt>).  (The 1.6 release has
	 more logging options, but SuSE 8.1 ships with netatalk 1.5.3.1,
	 and I don't use it so much any more that it's worth upgrading.)
    </td>
  </tr>
  <tr>
    <td> <a href="ntp.html"><tt>xntpd</tt></a></td>
    <td> Writes to <tt>/var/log/ntp</tt> via syslog in the default
	 configuration supplied by SuSE, but this is controlled by the
	 "logfile" directive in <tt>/etc/ntpd.conf</tt>.  (The default
	 tarball installation uses <tt>/var/log/messages</tt>).
    </td> 
  </tr>
  <tr>
    <td> <a href="aolserver.html">AOLserver</a></td>
    <td> <tt>/usr/local/aolserver/servers/rgrjr/modules/nslog/access.log</tt>
	 for Web hits to the "rgrjr" server, and
	 <tt>/usr/local/aolserver/log/server.log</tt> for AOLserver
	 itself.
    </td>
  </tr>
  <tr>
    <td> <a href="squid.html">Squid</a></td>
    <td> <tt>cache.log</tt>, <tt>access.log</tt>, and <tt>store.log</tt>
	 in <tt>/var/log/squid/</tt>.  More about these log files on my
	 <a href="squid.html#squid-log-file">Squid page</a>.
    </td>
  </tr>
  <tr>
    <td> <a href="#samba">Samba</a></td>
    <td> <tt>/var/log/samba/log.nmb</tt> and
	 <tt>/var/log/samba/log.smbd</tt>.  Note that by default, SuSE
	 configures Samba to keep a separate log file for each client
	 machine.
    </td>
  </tr>
</table>
</blockquote>

Fortunately, the AOLserver, Squid, and Samba servers are the only ones
that don't use the system logs.  (And only AOLserver is outside the
<tt>/var/log/</tt> tree, because it is the only server I still build
from the tarball, rather than using the SuSE-provided RPM.)

<p>[for suse 8.1, log rotation is now controlled (mostly) by
<tt>/etc/logrotate.d/syslog</tt>, which requires tweaking.  -- rgr,
13-May-03.]  [squid log rotation is controlled by
<tt>/etc/logrotate.d/squid</tt>, instead of doing
<tt>"squid&nbsp;-k&nbsp;rotate"</tt>; this also needed tweaking.  --
rgr, 29-Jun-03.]  [need to write up tweaking notes, describe the
logrotate package in outline.  -- rgr, 5-Jun-04.]

<a name = ezmlm>
<h3>The <tt>ezmlm</tt> mailing list manager</h3>

The <tt>ezmlm</tt> binaries are in <tt>/usr/bin/ezmlm/</tt>, which is
not on root's default path.  The easiest way to get these commands is to
<tt>"su&nbsp;alias"</tt> as root.
<dl class="howto">
  <dt> Create a new list:
  <dd> For the "linux" list, I did
       <pre>
       $ ezmlm-make ~alias/linux/ ~alias/.qmail-linux linux rgrjr.dyndns.org
</pre>
       as the <tt>alias</tt> user, so <tt>alias</tt> became the list
       owner.  (If I had done this as <tt>rogers</tt>, the list name in
       the third argument would have needed to be <tt>rogers-linux</tt>
       instead of <tt>linux</tt>.)

  <dt> Add or delete a subscriber manually:
  <dd> To subscribe manually, do
       <pre>
       $ ezmlm-sub ~alias/linux/ rogers@rgrjr.dyndns.org
</pre>
       as the list owner.  Lists are identified by their top-level
       directory, <tt>~alias/linux/</tt> in this case.  Unsubscription
       uses the <tt>ezmlm-unsub</tt> program.
</dl>

<a name = netatalk>
<h3>netatalk</h3>

<ul>
  <li> Current development happens at <a
       href="http://netatalk.sourceforge.net/">
       <tt>netatalk.sourceforge.net</tt></a>.  The latest release is
       1.6.
  <li> <a href="http://www.anders.com/projects/netatalk/">Linux
       Netatalk-HOWTO</a> (does not cover the current Sourceforge
       development stream).
  <li> Good overview of netatalk setup concepts and issues in the <a
       href="http://www.idg.net/crd_linux_72770.html"> "AppleTalk
       services under Linux"</a> article.
  <li> My UG/FAQ is on the <a
       href="http://bmerc-www.bu.edu/needle-doc/netatalk.html">
       <tt>http://bmerc-www.bu.edu/needle-doc/netatalk.html</tt></a>
       page.
  <li> Tunneling: See <a
       href="http://ebv.mimnet.northwestern.edu/%7Eaiyar/appletalk.html">
       "Tunneling Appletalk Through IP"</a>.  (Never had to do this
       myself.)
</ul>

<a name = samba>
<h3>Samba</h3>

<a href="http://www.samba.org/">Samba</a> is configured on this machine,
but not started by default, since I don't often use my Windows machine
(at least not for Windows; it also runs <a
href="http://www.suse.com/">SuSE Linux</a>).  To start it, I must do
<tt>"/etc/init.d/samba&nbsp;start"</tt> as root.

<p>In order to get Samba up and running at my site, I found the
following resources helpful:
<ol>
  <li> <a href="http://us3.samba.org/samba/samba.html">SAMBA - opening
       windows to a wider world</a> (a US mirror of the <a
       href="http://www.samba.org/">Samba</a> home site).
  <li> <a href="http://www.linuxdoc.org/HOWTO/SMB-HOWTO.html">SMB
       HOWTO</a>
  <li> <a
       href="http://de.samba.org/samba/ftp/docs/htmldocs/using_samba/">
       Using Samba</a> (online version of the <a
       href="http://www.oreilly.com/catalog/samba/">O'Reilly <b>Using
       Samba</b> book</a>, November 1999).
  <li> <a
       HREF="http://www.netspace.net.au/~bmiller/linux/NT-SAMBA-problem.html">
       Windows NT SP3 and 98 Client SAMBA Problem Page</a> 
  <li> <a
       href="file:/usr/local/src/samba-2.2.0/docs/htmldocs/ENCRYPTION.html">
       LanMan and NT Password Encryption in Samba 2.x</a> [part of the
       source distribution; I can't seem to find an online version right
       now.  -- rgr, 1-Dec-01.]
</ol>

<p>
<hr>
<p>
<a name=linux>
<h2>Linux guts</h2>

<a name = kernel>
<h3>Kernel</h3>

<p>Prior to upgrade, I had the following kernel-related code installed
(but deinstalled <tt>kernel-pcmcia-cs</tt> almost immediately because I
don't have the hardware):
<pre>
    kernel-headers-2.2.5-15
    kernel-2.2.5-15
    kernel-pcmcia-cs-2.2.5-15
    kernelcfg-0.5-5
    kernel-source-2.2.5-15
    mkinitrd-2.0-1
    SysVinit-2.77-2
    initscripts-4.16-1
</pre>

<a name=mem>
<h3>Memory management</h3>

Doing <tt>"cat&nbsp;/proc/meminfo"</tt> generates a report of current
usage.  See <tt>"man&nbsp;vmstat"</tt> for a tool to keep an eye on
memory usage.

<a name=rpm>
<h3><tt>rpm</tt> and <tt>rpmfind</tt></h3>

To install:
<pre>
   rpm -ivh /mnt/cdrom/RedHat/RPMS/sag*.rpm
</pre>
[Except I only have the CDROM for the Red Hat 6.0 distribution, which is
pretty out of date by now.  So I download off the net (fast on a cable
modem!) to a designated <a href="#zip">Zip disk</a>, and install at
leisure.  -- rgr, 3-Sep-00.]

<p>To query a single package:  <tt>"rpm&nbsp;-qil&nbsp;tripwire"</tt>
Drop the "-l" to omit file listing.

<p>To query recently installed packages:
<tt>"rpm&nbsp;-qa&nbsp;--last&nbsp;|&nbsp;head"</tt>

<p><tt>rpmfind</tt>: <a href="file:/usr/doc/rpmfind-1.2/README">
<tt>/usr/doc/rpmfind-1.2/README</tt></a>

<a name = xfree86>
<h3>XFree86</h3>

<p>The <tt>"DontZap"</tt> option in the <tt>"ServerFlags"</tt> section
of the <a href="file:/etc/X11/XF86Config">
<tt>/etc/X11/XF86Config</tt></a> file disables the
<tt>Crtl-Alt-Backspace</tt> server abort sequence, letting it through to
clients.  This option is essential for keeping us Zmacs alumni (who
expect <tt>C-M-DEL</tt> to be bound to <tt>backward-kill-sexp</tt>) from
going postal.  -- rgr, 19-Mar-00.

<p>
<hr>
<p>
<a name = hardware>
<h2>Hardware</h2>

See also the <a href="cd-burning.html">Burning CD-R disks</a> page.

<a name="zip">
<h3>Zip drive</h3>

<dl class="howto">
  <dt> <a name = zip-mount>
       Mounting:
  <dd> Use <tt>"mount&nbsp;/mnt/zip"</tt>.  If this fails with an
       error message that looks like this
       <pre>
       mount: the kernel does not recognize /dev/sda4 as a block device
              (maybe `insmod driver'?)
</pre>
       then this is probably because the machine was booted with the Zip
       drive off.  If that's the case, then
       <pre>
       modprobe imm
</pre>
       will probably be sufficient to get <tt>/dev/sda4</tt> recognized,
       after which the drive can be power cycled without needing to
       repeat the <tt>modprobe</tt>.  (The boot-time <tt>modprobe</tt>
       is done in the <a href="file:/etc/rc.d/rc.modules">
       <tt>/etc/rc.d/rc.modules</tt></a> script.  -- rgr, 28-Dec-99.)

       <p>
       If <tt>/var/log/messages</tt> says
       <pre>
       modprobe: can't locate module block-major-8
</pre>
       and <tt>lsmod</tt> shows <tt>imm</tt> already loaded, then do
       <pre>
       rmmod imm; modprobe imm
</pre>
       to force reloading.  -- rgr, 2-Jul-00.

       <p>
       <a name = zip-unmount>
  <dt> Unmounting:
  <dd> <tt>"umount&nbsp;/mnt/zip"</tt>, and then hit the button to
       eject.  Doing <tt>"eject&nbsp;/mnt/zip"</tt> seems to work, but
       only for root.

  <dt> Formatting:
  <dd> <tt>mke2fs /dev/sda4</tt>

       <a name = no-bad-blocks>
       <p>You can add the <tt>"-c"</tt> option to check for bad blocks,
       but I haven't found a bad block yet, and this is what takes most
       of the time (about 4.5 minutes), as it has to read the entire
       drive.  (My guess is that bad blocks are detected and "repaired"
       by the drive, so it's no surprise that I never found one.  --
       rgr, 7-Aug-01.)

  <dt> Checking for bad blocks:
  <dd> When doing <tt>badblocks</tt> on Zip, use 98288 for number of
       blocks -- this is (- (/ (* 2048 96) 2) 16), for 96 cyl, 2048
       blocks/cyl, 0.5k/block, minus some magic factor.  If there is
       some reason to suspect the existence of a bad block, one can also
       use the <tt>"-c"</tt> option to <tt>e2fsck</tt> when checking
       disk integrity (but see <a href="#no-bad-blocks">the comment
       under "Formatting"</a> above).

  <dt> Checking file system integrity:
  <dd> Periodically, when mounting Zip disks, the following warning will
       appear in <tt>/var/log/messages</tt>:
       <pre>
       EXT2-fs warning: maximal mount count reached, running e2fsck is recommended
</pre>
       To address this, <b>before</b> mounting the disk, do
       <pre>
       e2fsck -f /dev/sda4
</pre>
       The <tt>"-f"</tt> option will "Force checking even if the file
       system seems clean" (from the <tt>man</tt> page); without it,
       <tt>e2fsck</tt> does a quick check, so <tt>"-f"</tt> is more
       thorough.  You can also add the <tt>"-c"</tt> option to request
       bad block checking (but see <a href="#no-bad-blocks">the comment
       under "Formatting"</a> above).

  <dt> Erasing:
  <dd> To erase a Zip disk thoroughly (or any other disk device or
       partition for that matter), you can do a "write" test to check
       for bad blocks:
       <pre>
       badblocks -w /dev/sda4 98288
</pre>
       This takes a while, as it writes a number of patterns across the
       whole disk, and then rereads them.  Each read/write pass takes
       about nine minutes; the whole process is more than half an hour.
</dl>

<p>Note the existence of the <tt>mzip</tt> command.

<p>[The "Zip drive backup" section that was here has been renamed and
given <a href="backup.html">its own page.</a> -- rgr, 7-Aug-01.]

<a name=floppy>
<h3>Floppy disk</h3>

<dl class="howto">
  <dt> Formatting:
  <dd> For a 1.44MB floppy, use:
       <pre>
       fdformat /dev/fd0H1440
</pre>
       Other densities use different magical device names.

  <dt> Building an <tt>ext2</tt> file system:
  <dd> <code>mkfs.ext2 -c /dev/fd0H1440</code>

  <dt> Making a boot image:
  <dd> <code>dd if=/mnt/cdrom/images/boot.img of=/dev/fd0
       bs=1440k</code>
</dl>

<p>
<hr>
<p>
<a name = apps>
<h2>Applications</h2>

<a name = lisps>
<h3>Alternative lisps</h3>

<p>CLISP on the <tt>http://clisp.cons.org/~haible/clisp.html</tt> page.
-- rgr, 6-Nov-98.  Version 18 of cmu-cl is available from the <a
href="http://www.cons.org/cmucl/">
<tt>http://www.cons.org/cmucl/</tt></a> page.  Version 17 still exists
in the ftp://ftp.cs.cmu.edu/afs/cs.cmu.edu/project/clisp/release/
directory; see the
http://www.cs.cmu.edu/afs/cs/project/ai-repository/ai/lang/lisp/impl/cmucl/0.html
page.  LispWorks now sold by <a
href="http://www.xanalys.com/">"Xanalys"</a> but appears moribund.  --
rgr, 21-Apr-00.

<p>
<hr>
<address><a href="/bob/contact.html">Bob Rogers
	<tt>&lt;rogers@rgrjr.dyndns.org&gt;</tt></a></address>
$Id$
</body>
</html>
