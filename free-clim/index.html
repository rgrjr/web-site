<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html> <head>
<title>Simple CLIM stuff</title>
</head>

<body bgcolor=white>
<h1>Emulation of some CLIM features</h1>

Given this database:

<blockquote>
<pre>
YAL054C	273.973	713	0	0	ACS1 acetyl-CoA biosynthesis acetyl-CoA synthetase
MTH217	262.228	558	0	0	acetyl-CoA synthetase 2621263 AAB84723.1 
APE2604	246.924	513	0	0	hypothetical acetyl-coenzyme A synthetase 5106310
MTH1603	170.836	400	0	0	acetyl-CoA synthetase 2622727 AAB86076.1 
MTH1604	122.651	249	0	0	acetyl-CoA synthetase 2622728 AAB86077.1 
AF0976	112.017	551	0	0	acetyl-CoA synthetase (acs-5) {Bacillus subtilis}
CEK03A1_5	109.582	700	0	0	ACETYL-COENZYME SYNTHETASE NULL NULL 
AF1510	106.236	552	0	0	long-chain-fatty-acid--CoA ligase (fadD-6) {Escherichia coli}
AF0687	88.4709	549	0	0	long-chain-fatty-acid--CoA ligase (fadD-3) {Escherichia coli}
AF0262	82.8227	551	0	0	medium-chain acyl-CoA ligase (alkK-2) {Pseudomonas
Rv2948c	81.153	705	0	0	fadD22 acyl-CoA synthase 1781165 CAB06101.1
Rv0166	80.9432	554	0	0	fadD5 acyl-CoA synthase 2213503 CAB09749.1
Rv3089	80.5321	503	0	0	fadD13 acyl-CoA synthase 2808436 CAA16147.1
Rv2384	80.437	565	0	0	mbtA mycobactin/exochelin synthesis (salicylate-AMP ligase)
Rv1058	79.71	543	0	0	fadD14 acyl-CoA synthase 2896695 CAA17174.1
MTH657	79.1871	548	0	0	long-chain-fatty-acid-CoA ligase 2621739 AAB85162.1 
Rv2505c	79.1836	547	0	0	fadD35 acyl-CoA synthase 2113938 CAB08923.1
YBR222C	77.5575	543	0	0	FAT2 transport peroxisomal (putative) fatty
Rv0270	75.5045	560	0	0	fadD2 acyl-CoA synthase 1850115 CAB06682.1
AF0089	75.5022	542	0	0	long-chain-fatty-acid--CoA ligase (fadD-1) {Escherichia coli}
MTH701	73.7708	425	0	0	acetyl-CoA synthetase related protein 2621787
Rv3561	73.6573	507	0	0	fadD3 acyl-CoA synthase 1877292 CAB07136.1
Rv1427c	71.2163	535	0	0	fadD12 acyl-CoA synthase 2131069 CAB09257.1
AF1772	70.4628	569	0	0	long-chain-fatty-acid--CoA ligase (fadD-7) {Escherichia coli}
</pre>
</blockquote>

I can extract the words and produce a digraph.  Here's what the calling
code looks like:
<blockquote>
<pre>
(defun psg-print-node (node stream)
  ;; [sigh.  -- rgr, 24-Aug-00.]
  (declare (ignore stream))
  #+ignore (write-string (stem-name node) stream)
  (format-text-cell ()
    (stem-name node)))

(defun plot-stem-graph-internal (graph title)
  ;; replacement for hack-plot-stem-graph-internal that uses the
  ;; format-graph-from-roots interface.
  (format-graph-from-roots (list (stem-graph-start-stem graph))
			   #'psg-print-node
			   #'(lambda (stem)
			       (mapcar #'stem-edge-stem2 (stem-out-edges stem)))
			   ;; :stream stream
			   :center-nodes t
			   :graph-type :dag
			   ;; :arc-drawer #'draw-stem-graph-arc
			   :merge-duplicates t)
  (with-text-size (t 14)
    (with-text-face (t :italic)
      (format-text-cell (:h-align :center)
	(format nil "~A of ~D genes, with ~D stems and ~D edges"
		title
		(length (stem-graph-genes graph))
		(length (stem-graph-stems graph))
		(length (stem-graph-edges graph))))))
  ;; this would be a terpri if we had a real stream.
  (format-text-cell () ""))

(defun hack-plot-stem-graphs (graphs)
  (let ((*parent* (make-instance 'stream-composite-part :margin 10 :spacing 10
				 ;; [kludge width so centering works.]
				 :x2 720 :h-align :center :v-align :top))
	(*connector-gensym-index* 0)	;; renumber graphs from 1.
	(graph-count 0))
    (dolist (graph graphs)
      (incf graph-count)
      (plot-stem-graph-internal graph
				(format nil "Subgraph ~D" graph-count)))
    (place-part *parent*)
    (eliminate-negative-coords *parent*)
    *parent*))
</pre>
</blockquote>

Plotting this digraph looks like this:

<p>
<map name="ex-0306-4">
<!--boilerplate nl
	do="cd /home1/staff/rogers/projects/annotation; make install-ex-0306-4"
	insert-file="/home1/staff/rogers/projects/annotation/ex-0306-4.map" -->
<area shape=rect coords="10,147 60,159" alt="(start)" href="#(start)">
<area shape=rect coords="90,279 176,291" alt="HYPOTHETICAL" href="#HYPOTHETICAL">
<area shape=rect coords="118,257 147,269" alt="LONG" href="#LONG">
<area shape=rect coords="111,235 154,247" alt="MEDIUM" href="#MEDIUM">
<area shape=rect coords="111,213 154,225" alt="FADD22" href="#FADD22">
<area shape=rect coords="115,191 151,203" alt="FADD5" href="#FADD5">
<area shape=rect coords="111,169 154,181" alt="FADD13" href="#FADD13">
<area shape=rect coords="118,147 147,159" alt="MBTA" href="#MBTA">
<area shape=rect coords="111,125 154,137" alt="FADD14" href="#FADD14">
<area shape=rect coords="111,103 154,115" alt="FADD35" href="#FADD35">
<area shape=rect coords="118,81 147,93" alt="FAT2" href="#FAT2">
<area shape=rect coords="115,59 151,71" alt="FADD2" href="#FADD2">
<area shape=rect coords="115,37 151,49" alt="FADD3" href="#FADD3">
<area shape=rect coords="111,15 154,27" alt="FADD12" href="#FADD12">
<area shape=rect coords="220,284 263,296" alt="ACETYL" href="#ACETYL">
<area shape=rect coords="224,193 260,205" alt="CHAIN" href="#CHAIN">
<area shape=rect coords="206,102 278,114" alt="MYCOBACTIN" href="#MYCOBACTIN">
<area shape=rect coords="209,11 274,23" alt="TRANSPORT" href="#TRANSPORT">
<area shape=rect coords="318,284 376,296" alt="COENZYME" href="#COENZYME">
<area shape=rect coords="333,193 362,205" alt="ACYL" href="#ACYL">
<area shape=rect coords="315,102 380,114" alt="EXOCHELIN" href="#EXOCHELIN">
<area shape=rect coords="308,11 387,23" alt="PEROXISOMAL" href="#PEROXISOMAL">
<area shape=rect coords="446,284 453,296" alt="A" href="#A">
<area shape=rect coords="417,147 482,159" alt="SYNTHESIS" href="#SYNTHESIS">
<area shape=rect coords="420,10 478,22" alt="PUTATIVE" href="#PUTATIVE">
<area shape=rect coords="530,284 566,296" alt="FATTY" href="#FATTY">
<area shape=rect coords="512,10 584,22" alt="SALICYLATE" href="#SALICYLATE">
<area shape=rect coords="614,284 643,296" alt="ACID" href="#ACID">
<area shape=rect coords="617,10 639,22" alt="AMP" href="#AMP">
<area shape=rect coords="111,398 133,410" alt="COA" href="#COA">
<area shape=rect coords="163,469 235,481" alt="SYNTHETASE" href="#SYNTHETASE">
<area shape=rect coords="177,398 220,410" alt="LIGASE" href="#LIGASE">
<area shape=rect coords="170,327 228,339" alt="SYNTHASE" href="#SYNTHASE">
<area shape=rect coords="279,469 301,481" alt="ACS" href="#ACS">
<area shape=rect coords="275,422 304,434" alt="FADD" href="#FADD">
<area shape=rect coords="275,375 304,387" alt="ALKK" href="#ALKK">
<area shape=rect coords="265,328 315,340" alt="RELATED" href="#RELATED">
<area shape=rect coords="366,467 373,479" alt="1" href="#1">
<area shape=rect coords="366,444 373,456" alt="5" href="#5">
<area shape=rect coords="366,421 373,433" alt="6" href="#6">
<area shape=rect coords="366,398 373,410" alt="3" href="#3">
<area shape=rect coords="366,375 373,387" alt="2" href="#2">
<area shape=rect coords="345,352 395,364" alt="PROTEIN" href="#PROTEIN">
<area shape=rect coords="366,329 373,341" alt="7" href="#7">
<area shape=rect coords="425,398 461,410" alt="(end)" href="#(end)">
<area shape=rect coords="150,502 570,516" alt="Subgraph 1 of 22 genes, with 45 stems and 71 edges" href="#Subgraph 1 of 22 genes, with 45 stems and 71 edges">
<!--/boilerplate-->
</map>

<center>
<p>
<img src="ex-0306-4.png" usemap="#ex-0306-4">

<p>
<font size=-1>
<i>Figure 1: ex-0306-4.png</i>
</font>
</center>

<p>The bits of text are mouse sensitive (but you'll notice some offset
bugs; go about 20 pixels up and right of the text)), though the URLs
don't do anything useful.  Note the numbered line continuation
connectors.  A slightly snazzier version puts the connectors in red
boxes (and drops the square brackets), in addition to indenting
continuations, and drawing lines with thickness proportional to the
number of times the word pair appears in the input database.  (Not to
mention not having the offset bugs.)  That is the version in
"production" at <a href="http://bmerc-www.bu.edu/">BMERC</a>; see the <a
href="http://bmerc-www.bu.edu/needle-doc/new/ex-0306-4.html">
<tt>ex-0306-4.html</tt> page</a> for examples.  The graphics on this
page were produced by a new variation I am hacking that is cleaner
internally.  But it still has fatal design problems that could be fixed
by building on a low-level ICanCad graphics substrate.

<p>
<hr>
<address><a href="mailto:rogers@rgrjr.dyndns.org">Bob Rogers
	<tt>&lt;rogers@rgrjr.dyndns.org&gt;</tt></a></address>
<!-- hhmts start -->
Last modified: Wed Sep  6 23:59:08 EDT 2000
<!-- hhmts end -->
</body> </html>
